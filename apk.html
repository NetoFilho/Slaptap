<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Slaptap</title>
    <link rel="icon" type="image/png" href="Icon.png">
    <style>
        * {
            width: 100vw;
            height: 100vh;
            margin: 0;
            padding: 0;
            background: black;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <iframe src="https://slaptap.netlify.app/apk.html/" style="width:100%; height:100vh; border:none;"></iframe>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-messaging.js";

        const firebaseConfig = {
            apiKey: "AIzaSyArM-m7dvRhtLzSZWQegitYm3X-3QCdHf8",
            authDomain: "slaptap-70c69.firebaseapp.com",
            projectId: "slaptap-70c69",
            storageBucket: "slaptap-70c69.firebasestorage.app",
            messagingSenderId: "314393069162",
            appId: "1:314393069162:web:c2234e975c0491bc2bac13",
            measurementId: "G-CMKKTDN0DE"
        };

        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/firebase-messaging-sw.js')
                .then((registration) => {
                    console.log('Service Worker registrado:', registration);
                })
                .catch((error) => {
                    console.error('Erro ao registrar Service Worker:', error);
                });
        }

        async function requestPermission() {
            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log("Permissão concedida");

                    const token = await getToken(messaging, {
                        vapidKey: "BDg9aATizV0spxzCK6ZlSl9UKoKMfClHO_axPVK_F4muOA0UlpLE94RYtwSPmxuz-SFM3R_gRI6iQqCgAJM6RTo" // Pegue no Firebase Console (Configurações > Cloud Messaging)
                    });

                    if (token) {
                        console.log("Token FCM:", token);
                        // Envie esse token para o backend para enviar notificações
                    } else {
                        console.log("Nenhum token FCM disponível. Solicite permissão novamente.");
                    }
                } else {
                    console.log("Permissão negada para notificações.");
                }
            } catch (error) {
                console.error("Erro ao obter permissão:", error);
            }
        }

        requestPermission();

        onMessage(messaging, (payload) => {
            console.log("Mensagem recebida:", payload);
            new Notification(payload.notification.title, {
                body: payload.notification.body,
                icon: payload.notification.icon
            });
        });

    </script>
</body>

</html>